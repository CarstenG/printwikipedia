<?phpdefine('USERNAME','');define('PASSWORD','');define('LOGINURL','https://www.lulu.com/account/login');define('BOOKCREATEURL','http://www.lulu.com/author/wizard/index.php?fWizard=book');define('BOOKURL','http://www.lulu.com/author/wizard/index.php');define('AUTHOR_FIRSTNAME','Michael');define('AUTHOR_LASTNAME','Mandiberg');curl_login();function curl_login(){	//logs you in as michael manidberg	$ch = curl_init();	curl_setopt($ch, CURLOPT_URL, LOGINURL);	//so you don't error out with SSL	curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);	curl_setopt($ch, CURLOPT_POST, 1);	//post data	curl_setopt($ch, CURLOPT_POSTFIELDS, "userid=".urlencode(USERNAME)."&password=".urlencode(PASSWORD)."&doLogin=");	//show the header info, mostly for early debugging	curl_setopt($ch, CURLOPT_HEADER, 1);	//start a cookie session and set a place to store cookies	curl_setopt($ch, CURLOPT_COOKIESESSION, 1);	curl_setopt($ch, CURLOPT_COOKIEJAR, 'cookie.txt');	//return the CURL data to a string.	curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);	$str=curl_exec($ch);	curl_close($ch);	if (strpos($str,"SNICKERDOODLE")) {		print "Successfully Logged In.\n";		create_book('Book 004');	} else {			print "Could not login. Did not get the SNICKERDOODLE cookie.\n";			die();	}}function create_book($booktitle) {		//get the book ID from the create page	$ch1 = curl_init();	curl_setopt($ch1, CURLOPT_URL, BOOKCREATEURL);	curl_setopt($ch1, CURLOPT_COOKIEFILE, 'cookie.txt');	curl_setopt($ch1, CURLOPT_COOKIEJAR, 'cookie.txt');	curl_setopt($ch1, CURLOPT_HEADER, 1);	curl_setopt($ch1, CURLOPT_RETURNTRANSFER, 1);	$str1 = curl_exec($ch1);	curl_close($ch1);	//gotta parse the book id out of the HTML using regular expressions	preg_match('/name="fCID" value=".[0-9]{1,9}"/',$str1,$matches);	preg_match('/[0-9]{1,9}/',$matches[0],$matches2);	$bookid=$matches2[0];	if ((!$bookid) || ($bookid==""))	{		print "Could not get the newly created Book ID\n";		die();	} else {		print "Got a new Book ID, ready to set options\n";	}	//now with the new ID we start to set the books settings	$ch2 = curl_init();	curl_setopt($ch2, CURLOPT_URL, BOOKURL);	curl_setopt($ch2, CURLOPT_POST, 1);	$postdata2="fCID=".urlencode($bookid)."&fAction=processBasicMetaData&fWizard=book&fProductFlavor=0&fTitle=".urlencode($booktitle)."&AUTHOR_FORM%5B0%5D%5Bfirst_name%5D=".urlencode(AUTHOR_FIRSTNAME)."&AUTHOR_FORM%5B0%5D%5Blast_name%5D=".urlencode(AUTHOR_LASTNAME)."&fIntent=retail";	curl_setopt($ch2, CURLOPT_POSTFIELDS,$postdata2);	curl_setopt($ch2, CURLOPT_COOKIEFILE, 'cookie.txt');	curl_setopt($ch2, CURLOPT_COOKIEJAR, 'cookie.txt');	curl_setopt($ch2, CURLOPT_HEADER, 1);	curl_setopt($ch2, CURLOPT_RETURNTRANSFER, 1);	$str2 = curl_exec($ch2);	curl_close($ch2);	//next step in the book settings	$ch3 = curl_init();	curl_setopt($ch3, CURLOPT_URL, BOOKURL);	curl_setopt($ch3, CURLOPT_POST, 1);	$postdata3="fCID=".urlencode($bookid)."&fAction=processBookProperties&fPODPackage%5Binterior_paper_coating%5D=1&fPODPackage%5Btrim_size_id%5D=2&fPODPackage%5Bbinding_type%5D=perfect&fPODPackage%5Binterior_ink_color_id%5D=2";	curl_setopt($ch3, CURLOPT_POSTFIELDS,$postdata3);	curl_setopt($ch3, CURLOPT_COOKIEFILE, 'cookie.txt');	curl_setopt($ch3, CURLOPT_COOKIEJAR, 'cookie.txt');	curl_setopt($ch3, CURLOPT_HEADER, 1);	curl_setopt($ch3, CURLOPT_RETURNTRANSFER, 1);	$str3 = curl_exec($ch3);	curl_close($ch3);	//finally determine what kind of ISBN to get	$ch4 = curl_init();	curl_setopt($ch4, CURLOPT_HEADER, Array('Content-Type' => 'multipart/form-data'));	curl_setopt($ch4, CURLOPT_URL, BOOKURL);	curl_setopt($ch4, CURLOPT_POST, 1);	$postdata4=array(		"fCID" =>	$bookid,		"fAction" =>	"processIsbnAssignmentPage",		"fIsbnAssignmentSelector" => "free_isbn",		"fName" => "",			"fStreet1" =>	"",			"fStreet2" =>	"",			"fCity" =>	"",				"fCountry" =>	"840",		"fState" =>	"AL",		"fZipCode" =>	"",				"fTelephone" =>	"",				"fISBN" =>	"",				"fConfirmISBN" =>	"",			"fImprint" =>	""			);	curl_setopt($ch4, CURLOPT_POSTFIELDS,$postdata4);	curl_setopt($ch4, CURLOPT_COOKIEFILE, 'cookie.txt');	curl_setopt($ch4, CURLOPT_COOKIEJAR, 'cookie.txt');	curl_setopt($ch4, CURLOPT_HEADER, 1);	curl_setopt($ch4, CURLOPT_FOLLOWLOCATION, 1); 	curl_setopt($ch4, CURLOPT_RETURNTRANSFER, 1);	$str4 = curl_exec($ch4);	curl_close($ch4);	print $str4;	}?>